<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 智能抠图工具 (备用稳定版)</title>
    <!-- CSS 样式和之前完全一样 -->
    <style>:root { --primary-color: #007bff; --secondary-color: #6c757d; --bg-light: #f8f9fa; --bg-white: #ffffff; --border-color: #dee2e6; --text-dark: #343a40; --text-light: #6c757d; } body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: var(--bg-light); color: var(--text-dark); margin: 0; padding: 20px; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; } .container { width: 100%; max-width: 1000px; background-color: var(--bg-white); padding: 30px; border-radius: 12px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); } h1 { text-align: center; color: var(--primary-color); margin-bottom: 10px; } .subtitle { text-align: center; color: var(--text-light); margin-bottom: 30px; } .controls { text-align: center; margin-bottom: 30px; } input[type="file"] { display: none; } .file-label { display: inline-block; background-color: var(--primary-color); color: white; padding: 12px 25px; border-radius: 50px; cursor: pointer; font-size: 1.1rem; font-weight: bold; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0, 123, 255, 0.2); } .file-label:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 123, 255, 0.3); } #statusMessage { text-align: center; font-weight: bold; color: var(--secondary-color); height: 24px; margin-bottom: 20px; display: flex; justify-content: center; align-items: center; gap: 10px; } .spinner { width: 18px; height: 18px; border: 2px solid rgba(0,0,0,0.1); border-left-color: var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; display: none; } @keyframes spin { to { transform: rotate(360deg); } } .previews { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; } .preview-box { border: 2px dashed var(--border-color); border-radius: 8px; padding: 15px; } .preview-box h2 { text-align: center; margin-top: 0; color: var(--text-dark); font-size: 1.2rem; } .preview-box img { width: 100%; height: auto; border-radius: 4px; display: block; } #resultPreview { background-image: linear-gradient(45deg, #ccc 25%, transparent 25%), linear-gradient(135deg, #ccc 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #ccc 75%), linear-gradient(135deg, transparent 75%, #ccc 75%); background-size: 20px 20px; background-position: 0 0, 10px 0, 10px -10px, 0px 10px; } .download-area { text-align: center; margin-top: 30px; } #downloadButton { background-color: #28a745; color: white; padding: 12px 30px; font-size: 1.1rem; font-weight: bold; border: none; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.2); opacity: 0.5; pointer-events: none; } #downloadButton.ready { opacity: 1; pointer-events: auto; } #downloadButton:hover.ready { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(40, 167, 69, 0.3); } @media (max-width: 768px) { .previews { grid-template-columns: 1fr; } .container { padding: 20px; } }</style>
</head>
<body>
    <div class="container">
        <h1>AI 智能抠图工具 (备用稳定版)</h1>
        <p class="subtitle">使用另一个轻量级 AI 模型，兼容性更强</p>
        <div class="controls"><label for="imageLoader" class="file-label">选择图片</label><input type="file" id="imageLoader" accept="image/*"></div>
        <div id="statusMessage"><div id="spinner" class="spinner"></div><span id="statusText">请选择一张图片开始</span></div>
        <div class="previews">
            <div class="preview-box"><h2>原始图片</h2><img id="originalPreview" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="原始图片预览"></div>
            <div class="preview-box"><h2>透明背景结果</h2><img id="resultPreview" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="处理结果预览"></div>
        </div>
        <div class="download-area"><a id="downloadButton" href="#" download="transparent_image.png">下载透明图片 (PNG)</a></div>
    </div>
    
    <!-- 引入另一个 AI 库 -->
    <script src="https://cdn.jsdelivr.net/npm/background-removal-js@1.0.2/dist/background-removal.min.js"></script>

    <script>
        const imageLoader = document.getElementById('imageLoader');
        const originalPreview = document.getElementById('originalPreview');
        const resultPreview = document.getElementById('resultPreview');
        const downloadButton = document.getElementById('downloadButton');
        const statusText = document.getElementById('statusText');
        const spinner = document.getElementById('spinner');

        let originalFileName = '';
        let isProcessing = false;

        // 初始化备用 AI 模型
        const remover = new BackgroundRemoval();

        imageLoader.addEventListener('change', async (e) => {
            if (isProcessing) { alert('正在处理上一张图片，请稍候...'); return; }
            const file = e.target.files[0];
            if (!file) return;

            originalFileName = file.name.split('.').slice(0, -1).join('.');
            originalPreview.src = URL.createObjectURL(file);

            resultPreview.src = "data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";
            downloadButton.classList.remove('ready');
            downloadButton.href = '#';
            
            isProcessing = true;
            spinner.style.display = 'block';
            statusText.textContent = '正在加载并处理图片...';

            try {
                // 这个库的用法是直接传入图片文件
                const resultBlob = await remover.remove(file);
                const resultUrl = URL.createObjectURL(resultBlob);
                
                resultPreview.src = resultUrl;
                downloadButton.href = resultUrl;
                downloadButton.download = `${originalFileName}_transparent.png`;
                downloadButton.classList.add('ready');
                statusText.textContent = '处理完成！';
            } catch (error) {
                console.error("处理图片时出错:", error);
                statusText.textContent = '处理失败了，非常抱歉！';
                alert(`处理失败: ${error.message}`);
            } finally {
                isProcessing = false;
                spinner.style.display = 'none';
                imageLoader.value = '';
            }
        });
    </script>
</body>
</html>
